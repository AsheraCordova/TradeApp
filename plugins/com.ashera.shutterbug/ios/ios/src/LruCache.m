//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: D:\Java\git\core-ios-widgets\IOSShutterBugPlugin\src\main\java\com\applidium\shutterbug\cache\LruCache.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "LruCache.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/IllegalStateException.h"
#include "java/lang/Integer.h"
#include "java/lang/NullPointerException.h"
#include "java/util/Iterator.h"
#include "java/util/LinkedHashMap.h"
#include "java/util/Map.h"
#include "java/util/Set.h"

@class JavaUtilLinkedHashMap;


@interface APLruCache () {
 @public
  JavaUtilLinkedHashMap *map_;
  jint size_;
  jint maxSize_;
  jint putCount_;
  jint createCount_;
  jint evictionCount_;
  jint hitCount_;
  jint missCount_;
}

- (void)trimToSizeWithInt:(jint)maxSize;

- (jint)safeSizeOfWithId:(id)key
                  withId:(id)value;

@end

J2OBJC_FIELD_SETTER(APLruCache, map_, JavaUtilLinkedHashMap *)

__attribute__((unused)) static void APLruCache_trimToSizeWithInt_(APLruCache *self, jint maxSize);

__attribute__((unused)) static jint APLruCache_safeSizeOfWithId_withId_(APLruCache *self, id key, id value);

@implementation APLruCache

- (instancetype)initWithInt:(jint)maxSize {
  APLruCache_initWithInt_(self, maxSize);
  return self;
}

- (id)getWithId:(id)key {
  if (key == nil) {
    @throw new_JavaLangNullPointerException_initWithNSString_(@"key == null");
  }
  id mapValue;
  @synchronized(self) {
    mapValue = JreRetainedLocalValue([((JavaUtilLinkedHashMap *) nil_chk(map_)) getWithId:key]);
    if (mapValue != nil) {
      hitCount_++;
      return JreRetainedLocalValue(mapValue);
    }
    missCount_++;
  }
  id createdValue = [self createWithId:key];
  if (createdValue == nil) {
    return nil;
  }
  @synchronized(self) {
    createCount_++;
    mapValue = JreRetainedLocalValue([map_ putWithId:key withId:createdValue]);
    if (mapValue != nil) {
      (void) [map_ putWithId:key withId:mapValue];
    }
    else {
      size_ += APLruCache_safeSizeOfWithId_withId_(self, key, createdValue);
    }
  }
  if (mapValue != nil) {
    [self entryRemovedWithBoolean:false withId:key withId:createdValue withId:mapValue];
    return mapValue;
  }
  else {
    APLruCache_trimToSizeWithInt_(self, maxSize_);
    return createdValue;
  }
}

- (id)putWithId:(id)key
         withId:(id)value {
  if (key == nil || value == nil) {
    @throw new_JavaLangNullPointerException_initWithNSString_(@"key == null || value == null");
  }
  id previous;
  @synchronized(self) {
    putCount_++;
    size_ += APLruCache_safeSizeOfWithId_withId_(self, key, value);
    previous = JreRetainedLocalValue([((JavaUtilLinkedHashMap *) nil_chk(map_)) putWithId:key withId:value]);
    if (previous != nil) {
      size_ -= APLruCache_safeSizeOfWithId_withId_(self, key, previous);
    }
  }
  if (previous != nil) {
    [self entryRemovedWithBoolean:false withId:key withId:previous withId:value];
  }
  APLruCache_trimToSizeWithInt_(self, maxSize_);
  return previous;
}

- (void)trimToSizeWithInt:(jint)maxSize {
  APLruCache_trimToSizeWithInt_(self, maxSize);
}

- (id)removeWithId:(id)key {
  if (key == nil) {
    @throw new_JavaLangNullPointerException_initWithNSString_(@"key == null");
  }
  id previous;
  @synchronized(self) {
    previous = JreRetainedLocalValue([((JavaUtilLinkedHashMap *) nil_chk(map_)) removeWithId:key]);
    if (previous != nil) {
      size_ -= APLruCache_safeSizeOfWithId_withId_(self, key, previous);
    }
  }
  if (previous != nil) {
    [self entryRemovedWithBoolean:false withId:key withId:previous withId:nil];
  }
  return previous;
}

- (void)entryRemovedWithBoolean:(jboolean)evicted
                         withId:(id)key
                         withId:(id)oldValue
                         withId:(id)newValue {
}

- (id)createWithId:(id)key {
  return nil;
}

- (jint)safeSizeOfWithId:(id)key
                  withId:(id)value {
  return APLruCache_safeSizeOfWithId_withId_(self, key, value);
}

- (jint)sizeOfWithId:(id)key
              withId:(id)value {
  return 1;
}

- (void)evictAll {
  APLruCache_trimToSizeWithInt_(self, -1);
}

- (jint)size {
  @synchronized(self) {
    return size_;
  }
}

- (jint)maxSize {
  @synchronized(self) {
    return maxSize_;
  }
}

- (jint)hitCount {
  @synchronized(self) {
    return hitCount_;
  }
}

- (jint)missCount {
  @synchronized(self) {
    return missCount_;
  }
}

- (jint)createCount {
  @synchronized(self) {
    return createCount_;
  }
}

- (jint)putCount {
  @synchronized(self) {
    return putCount_;
  }
}

- (jint)evictionCount {
  @synchronized(self) {
    return evictionCount_;
  }
}

- (id<JavaUtilMap>)snapshot {
  @synchronized(self) {
    return JreRetainedLocalValue(new_JavaUtilLinkedHashMap_initWithJavaUtilMap_(map_));
  }
}

- (NSString *)description {
  @synchronized(self) {
    jint accesses = hitCount_ + missCount_;
    jint hitPercent = accesses != 0 ? (JreIntDiv(100 * hitCount_, accesses)) : 0;
    return JreRetainedLocalValue(NSString_java_formatWithNSString_withNSObjectArray_(@"LruCache[maxSize=%d,hits=%d,misses=%d,hitRate=%d%%]", [IOSObjectArray newArrayWithObjects:(id[]){ JavaLangInteger_valueOfWithInt_(maxSize_), JavaLangInteger_valueOfWithInt_(hitCount_), JavaLangInteger_valueOfWithInt_(missCount_), JavaLangInteger_valueOfWithInt_(hitPercent) } count:4 type:NSObject_class_()]));
  }
}

+ (const J2ObjcClassInfo *)__metadata {
  static J2ObjcMethodInfo methods[] = {
    { NULL, NULL, 0x1, -1, 0, -1, -1, -1, -1 },
    { NULL, "LNSObject;", 0x11, 1, 2, -1, 3, -1, -1 },
    { NULL, "LNSObject;", 0x11, 4, 5, -1, 6, -1, -1 },
    { NULL, "V", 0x2, 7, 0, -1, -1, -1, -1 },
    { NULL, "LNSObject;", 0x11, 8, 2, -1, 3, -1, -1 },
    { NULL, "V", 0x4, 9, 10, -1, 11, -1, -1 },
    { NULL, "LNSObject;", 0x4, 12, 2, -1, 3, -1, -1 },
    { NULL, "I", 0x2, 13, 5, -1, 14, -1, -1 },
    { NULL, "I", 0x4, 15, 5, -1, 14, -1, -1 },
    { NULL, "V", 0x11, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "I", 0x31, -1, -1, -1, -1, -1, -1 },
    { NULL, "LJavaUtilMap;", 0x31, -1, -1, -1, 16, -1, -1 },
    { NULL, "LNSString;", 0x31, 17, -1, -1, -1, -1, -1 },
  };
  #pragma clang diagnostic push
  #pragma clang diagnostic ignored "-Wobjc-multiple-method-names"
  #pragma clang diagnostic ignored "-Wundeclared-selector"
  methods[0].selector = @selector(initWithInt:);
  methods[1].selector = @selector(getWithId:);
  methods[2].selector = @selector(putWithId:withId:);
  methods[3].selector = @selector(trimToSizeWithInt:);
  methods[4].selector = @selector(removeWithId:);
  methods[5].selector = @selector(entryRemovedWithBoolean:withId:withId:withId:);
  methods[6].selector = @selector(createWithId:);
  methods[7].selector = @selector(safeSizeOfWithId:withId:);
  methods[8].selector = @selector(sizeOfWithId:withId:);
  methods[9].selector = @selector(evictAll);
  methods[10].selector = @selector(size);
  methods[11].selector = @selector(maxSize);
  methods[12].selector = @selector(hitCount);
  methods[13].selector = @selector(missCount);
  methods[14].selector = @selector(createCount);
  methods[15].selector = @selector(putCount);
  methods[16].selector = @selector(evictionCount);
  methods[17].selector = @selector(snapshot);
  methods[18].selector = @selector(description);
  #pragma clang diagnostic pop
  static const J2ObjcFieldInfo fields[] = {
    { "map_", "LJavaUtilLinkedHashMap;", .constantValue.asLong = 0, 0x12, -1, -1, 18, -1 },
    { "size_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "maxSize_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "putCount_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "createCount_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "evictionCount_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "hitCount_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
    { "missCount_", "I", .constantValue.asLong = 0, 0x2, -1, -1, -1, -1 },
  };
  static const void *ptrTable[] = { "I", "get", "LNSObject;", "(TK;)TV;", "put", "LNSObject;LNSObject;", "(TK;TV;)TV;", "trimToSize", "remove", "entryRemoved", "ZLNSObject;LNSObject;LNSObject;", "(ZTK;TV;TV;)V", "create", "safeSizeOf", "(TK;TV;)I", "sizeOf", "()Ljava/util/Map<TK;TV;>;", "toString", "Ljava/util/LinkedHashMap<TK;TV;>;", "<K:Ljava/lang/Object;V:Ljava/lang/Object;>Ljava/lang/Object;" };
  static const J2ObjcClassInfo _APLruCache = { "LruCache", "com.applidium.shutterbug.cache", ptrTable, methods, fields, 7, 0x1, 19, 8, -1, -1, -1, 19, -1 };
  return &_APLruCache;
}

@end

void APLruCache_initWithInt_(APLruCache *self, jint maxSize) {
  NSObject_init(self);
  if (maxSize <= 0) {
    @throw new_JavaLangIllegalArgumentException_initWithNSString_(@"maxSize <= 0");
  }
  self->maxSize_ = maxSize;
  self->map_ = new_JavaUtilLinkedHashMap_initWithInt_withFloat_withBoolean_(0, 0.75f, true);
}

APLruCache *new_APLruCache_initWithInt_(jint maxSize) {
  J2OBJC_NEW_IMPL(APLruCache, initWithInt_, maxSize)
}

APLruCache *create_APLruCache_initWithInt_(jint maxSize) {
  J2OBJC_CREATE_IMPL(APLruCache, initWithInt_, maxSize)
}

void APLruCache_trimToSizeWithInt_(APLruCache *self, jint maxSize) {
  while (true) {
    id key;
    id value;
    @synchronized(self) {
      if (self->size_ < 0 || ([((JavaUtilLinkedHashMap *) nil_chk(self->map_)) isEmpty] && self->size_ != 0)) {
        @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$$", [[self java_getClass] getName], @".sizeOf() is reporting inconsistent results!"));
      }
      if (self->size_ <= maxSize || [((JavaUtilLinkedHashMap *) nil_chk(self->map_)) isEmpty]) {
        break;
      }
      id<JavaUtilMap_Entry> toEvict = [((id<JavaUtilIterator>) nil_chk([((id<JavaUtilSet>) nil_chk([((JavaUtilLinkedHashMap *) nil_chk(self->map_)) entrySet])) iterator])) next];
      key = JreRetainedLocalValue([((id<JavaUtilMap_Entry>) nil_chk(toEvict)) getKey]);
      value = JreRetainedLocalValue([toEvict getValue]);
      (void) [self->map_ removeWithId:key];
      self->size_ -= APLruCache_safeSizeOfWithId_withId_(self, key, value);
      self->evictionCount_++;
    }
    [self entryRemovedWithBoolean:true withId:key withId:value withId:nil];
  }
}

jint APLruCache_safeSizeOfWithId_withId_(APLruCache *self, id key, id value) {
  jint result = [self sizeOfWithId:key withId:value];
  if (result < 0) {
    @throw new_JavaLangIllegalStateException_initWithNSString_(JreStrcat("$@C@", @"Negative size: ", key, '=', value));
  }
  return result;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(APLruCache)
